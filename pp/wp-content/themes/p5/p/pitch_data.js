var PITCH_DATA = [{
  'inter': 'A0',
  'man': 'A1',
  'woman': 'A2',
  'value': 27.5
}, {
  'inter': 'Bb0',
  'man': '#A1',
  'woman': '#A2',
  'value': 29.14
}, {
  'inter': 'B0',
  'man': 'B1',
  'woman': 'B2',
  'value': 30.87
}, {
  'inter': 'C1',
  'man': 'C',
  'woman': 'C1',
  'value': 32.7
}, {
  'inter': 'Db1',
  'man': '#C',
  'woman': '#C1',
  'value': 34.65
}, {
  'inter': 'D1',
  'man': 'D',
  'woman': 'D1',
  'value': 36.71
}, {
  'inter': 'Eb1',
  'man': '#D',
  'woman': '#D1',
  'value': 38.89
}, {
  'inter': 'E1',
  'man': 'E',
  'woman': 'E1',
  'value': 41.2
}, {
  'inter': 'F1',
  'man': 'F',
  'woman': 'F1',
  'value': 43.65
}, {
  'inter': 'Gb1',
  'man': '#F',
  'woman': '#F1',
  'value': 46.25
}, {
  'inter': 'G1',
  'man': 'G',
  'woman': 'G1',
  'value': 49
}, {
  'inter': 'Ab1',
  'man': '#G',
  'woman': '#G1',
  'value': 51.91
}, {
  'inter': 'A1',
  'man': 'A',
  'woman': 'A1',
  'value': 55
}, {
  'inter': 'Bb1',
  'man': '#A',
  'woman': '#A1',
  'value': 58.27
}, {
  'inter': 'B1',
  'man': 'B',
  'woman': 'B1',
  'value': 61.74
}, {
  'inter': 'C2',
  'man': 'c',
  'woman': 'C',
  'value': 65.41
}, {
  'inter': 'Db2',
  'man': '#c',
  'woman': '#C',
  'value': 69.3
}, {
  'inter': 'D2',
  'man': 'd',
  'woman': 'D',
  'value': 73.42
}, {
  'inter': 'Eb2',
  'man': '#d',
  'woman': '#D',
  'value': 77.78
}, {
  'inter': 'E2',
  'man': 'e',
  'woman': 'E',
  'value': 82.41
}, {
  'inter': 'F2',
  'man': 'f',
  'woman': '#F',
  'value': 87.31
}, {
  'inter': 'Gb2',
  'man': '#f',
  'woman': 'F',
  'value': 92.5
}, {
  'inter': 'G2',
  'man': 'g',
  'woman': 'G',
  'value': 98
}, {
  'inter': 'Ab2',
  'man': '#g',
  'woman': '#G',
  'value': 103.83
}, {
  'inter': 'A2',
  'man': 'a',
  'woman': 'A',
  'value': 110
}, {
  'inter': 'Bb2',
  'man': '#a',
  'woman': '#A',
  'value': 116.54
}, {
  'inter': 'B2',
  'man': 'b',
  'woman': 'B',
  'value': 123.47
}, {
  'inter': 'C3',
  'man': 'c1',
  'woman': 'c',
  'value': 130.81
}, {
  'inter': 'Db3',
  'man': '#c1',
  'woman': '#c',
  'value': 138.59
}, {
  'inter': 'D3',
  'man': 'd1',
  'woman': 'd',
  'value': 146.83
}, {
  'inter': 'Eb3',
  'man': '#d1',
  'woman': '#d',
  'value': 155.56
}, {
  'inter': 'E3',
  'man': 'e1',
  'woman': 'e',
  'value': 164.81
}, {
  'inter': 'F3',
  'man': 'f1',
  'woman': 'f',
  'value': 174.61
}, {
  'inter': 'Gb3',
  'man': '#f1',
  'woman': '#f',
  'value': 185
}, {
  'inter': 'G3',
  'man': 'g1',
  'woman': 'g',
  'value': 196
}, {
  'inter': 'Ab3',
  'man': '#g1',
  'woman': '#g',
  'value': 207.65
}, {
  'inter': 'A3',
  'man': 'a1',
  'woman': 'a',
  'value': 220
}, {
  'inter': 'Bb3',
  'man': '#a1',
  'woman': '#a',
  'value': 233.08
}, {
  'inter': 'B3',
  'man': 'b1',
  'woman': 'b',
  'value': 246.94
}, {
  'inter': 'C4',
  'man': 'c2',
  'woman': 'c1',
  'value': 261.63
}, {
  'inter': 'Db4',
  'man': '#c2',
  'woman': '#c1',
  'value': 277.18
}, {
  'inter': 'D4',
  'man': 'd2',
  'woman': 'd1',
  'value': 293.66
}, {
  'inter': 'Eb4',
  'man': '#d2',
  'woman': '#d1',
  'value': 311.13
}, {
  'inter': 'E4',
  'man': 'e2',
  'woman': 'e1',
  'value': 329.63
}, {
  'inter': 'F4',
  'man': 'f2',
  'woman': 'f1',
  'value': 349.23
}, {
  'inter': 'Gb4',
  'man': '#f2',
  'woman': '#f1',
  'value': 369.99
}, {
  'inter': 'G4',
  'man': 'g2',
  'woman': 'g1',
  'value': 392
}, {
  'inter': 'Ab4',
  'man': '#g2',
  'woman': '#g1',
  'value': 415.3
}, {
  'inter': 'A4',
  'man': 'a2',
  'woman': 'a1',
  'value': 440
}, {
  'inter': 'Bb4',
  'man': '#a2',
  'woman': '#a1',
  'value': 466.16
}, {
  'inter': 'B4',
  'man': 'b2',
  'woman': 'b1',
  'value': 493.88
}, {
  'inter': 'C5',
  'man': 'c3',
  'woman': 'c2',
  'value': 523.25
}, {
  'inter': 'Db5',
  'man': '#c3',
  'woman': '#c2',
  'value': 554.37
}, {
  'inter': 'D5',
  'man': 'd3',
  'woman': 'd2',
  'value': 587.33
}, {
  'inter': 'Eb5',
  'man': '#d3',
  'woman': '#d2',
  'value': 622.25
}, {
  'inter': 'E5',
  'man': 'e3',
  'woman': 'e2',
  'value': 659.26
}, {
  'inter': 'F5',
  'man': 'f3',
  'woman': 'f2',
  'value': 698.46
}, {
  'inter': 'Gb5',
  'man': '#f3',
  'woman': '#f2',
  'value': 739.99
}, {
  'inter': 'G5',
  'man': 'g3',
  'woman': 'g2',
  'value': 783.99
}, {
  'inter': 'Ab5',
  'man': '#g3',
  'woman': '#g2',
  'value': 830.61
}, {
  'inter': 'A5',
  'man': 'a3',
  'woman': 'a2',
  'value': 880
}, {
  'inter': 'Bb5',
  'man': '#a3',
  'woman': '#a2',
  'value': 932.33
}, {
  'inter': 'B5',
  'man': 'b3',
  'woman': 'b2',
  'value': 987.77
}, {
  'inter': 'C6',
  'man': 'c4',
  'woman': 'c3',
  'value': 1046.5
}, {
  'inter': 'Db6',
  'man': '#c4',
  'woman': '#c3',
  'value': 1108.73
}, {
  'inter': 'D6',
  'man': 'd4',
  'woman': 'd3',
  'value': 1174.66
}, {
  'inter': 'Eb6',
  'man': '#d4',
  'woman': '#d3',
  'value': 1244.51
}, {
  'inter': 'E6',
  'man': 'e4',
  'woman': 'e3',
  'value': 1318.51
}, {
  'inter': 'F6',
  'man': 'f4',
  'woman': 'f3',
  'value': 1396.91
}, {
  'inter': 'Gb6',
  'man': '#f4',
  'woman': '#f3',
  'value': 1479.98
}, {
  'inter': 'G6',
  'man': 'g4',
  'woman': 'g3',
  'value': 1567.98
}, {
  'inter': 'Ab6',
  'man': '#g4',
  'woman': '#g3',
  'value': 1661.22
}, {
  'inter': 'A6',
  'man': 'a4',
  'woman': 'a3',
  'value': 1760
}, {
  'inter': 'Bb6',
  'man': '#a4',
  'woman': '#a3',
  'value': 1864.66
}, {
  'inter': 'B6',
  'man': 'b4',
  'woman': 'b3',
  'value': 1975.53
}, {
  'inter': 'C7',
  'man': 'c5',
  'woman': 'c4',
  'value': 2093
}, {
  'inter': 'Db7',
  'man': '#c5',
  'woman': '#c4',
  'value': 2217.46
}, {
  'inter': 'D7',
  'man': 'd5',
  'woman': 'd4',
  'value': 2349.32
}, {
  'inter': 'Eb7',
  'man': '#d5',
  'woman': '#d4',
  'value': 2489.02
}, {
  'inter': 'E7',
  'man': 'e5',
  'woman': 'e4',
  'value': 2637.02
}, {
  'inter': 'F7',
  'man': 'f5',
  'woman': 'f4',
  'value': 2793.83
}, {
  'inter': 'Gb7',
  'man': '#f5',
  'woman': '#f4',
  'value': 2959.96
}, {
  'inter': 'G7',
  'man': 'g5',
  'woman': 'g4',
  'value': 3135.96
}, {
  'inter': 'Ab7',
  'man': '#g5',
  'woman': '#g4',
  'value': 3322.44
}, {
  'inter': 'A7',
  'man': 'a5',
  'woman': 'a4',
  'value': 3520
}, {
  'inter': 'Bb7',
  'man': '#a5',
  'woman': '#a4',
  'value': 3729.31
}, {
  'inter': 'B7',
  'man': 'b5',
  'woman': 'b4',
  'value': 3951.07
}, {
  'inter': 'C8',
  'man': 'c6',
  'woman': 'c5',
  'value': 4186.01
}];


function getPitch(freq) {
  'use strict';

  var minIndex = 0;
  var maxIndex = PITCH_DATA.length - 1;
  var currentIndex;
  var currentElement;
  if (freq > PITCH_DATA[maxIndex].value) return PITCH_DATA[maxIndex];

  while (minIndex <= maxIndex) {
    currentIndex = (minIndex + maxIndex) / 2 | 0;
    currentElement = PITCH_DATA[currentIndex];

    if (currentElement.value < freq) {
      minIndex = currentIndex + 1;
    } else if (currentIndex < maxIndex) {
      maxIndex = currentIndex;
    } else {
      if (currentIndex > 0 && Math.abs(PITCH_DATA[currentIndex].value - freq) >
        Math.abs(PITCH_DATA[currentIndex - 1].value - freq)) {
        return PITCH_DATA[currentIndex - 1];
      }
      return currentElement;
    }
  }

  return PITCH_DATA[0];
}

var RANGE_DATA = {
  man_high: {low:'C3', high: 'C5'},
  man_low: {low:'E2', high: 'E4'},
  woman_high: {low:'C4', high: 'C6'},
  woman_low: {low:'F3', high: 'F5'},
};

function getRange(name) {
  var range = RANGE_DATA[name];
  if (range && !range.name) {
    for (var i = 0; i < PITCH_DATA.length; ++i) {
      var pitch = PITCH_DATA[i];
      if (pitch.inter == range.low) {
        range.low = pitch;
      } else if (pitch.inter == range.high) {
        range.high = pitch;
      }
    }
    range.name = Locale.get(name);
  }
  return range;
}

var Locale = {
  locale: 'cn',
  your_pitch: {
    en: 'Your pitch is: ',
    cn: '系统检测当前音高为：',
  },
  your_vocal:  {
    en: 'Your vocal is: ',
    cn: '系统认定你的声音为：',
  },
  pure_modal_voice:  {
    en: 'Modal voice',
    cn: '真声',
  },
  modal_voice:  {
    en: 'Modal voice',
    cn: '真声',
  },
  mix_voice:  {
    en: 'Mix voice',
    cn: '混声',
  },
  half_fake_voice:  {
    en: 'Half modal voice',
    cn: '混声',
  },
  fake_voice:  {
    en: 'Falsetto voice',
    cn: '假声',
  },
  pure_fake_voice:  {
    en: 'Falsetto voice',
    cn: '假声',
  },
  super_fake_voice:  {
    en: 'Falsetto voice',
    cn: '假出翔',
  },
  head_voice:  {
    en: 'Head voice',
    cn: '头声',
  },
  overtone:  {
    en: 'Overtone',
    cn: '泛音',
  },
  paused:  {
    en: 'Paused',
    cn: '已暂停',
  },
  no_mic:  {
    en: "Your browser doesn't support mic",
    cn: '你的浏览器不支持麦克输入，请选择本地mp3文件。\n推荐使用Chrome / Firefox。',
  },
  no_support:  {
    en: "Your browser doesn't support this page",
    cn: '你的浏览器不支持音频处理。\n推荐使用Chrome / Firefox。',
  },
  man_high:  {
    en: 'man high',
    cn: '男高音',
  },
  man_low:  {
    en: 'man low',
    cn: '男低音',
  },
  woman_high:  {
    en: 'woman high',
    cn: '女高音',
  },
  woman_low:  {
    en: 'woman low',
    cn: '女低音',
  },
  man:  {
    en: 'Man',
    cn: '男',
  },
  woman:  {
    en: 'Woman',
    cn: '女',
  },
  
  get: function(name) {
    var str = this[name];
    if (str) {
      return str[this.locale];
    }
    return null;
  }
};